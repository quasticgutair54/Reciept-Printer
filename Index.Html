<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Receipt Glitch Labyrinth</title>
    <style>
        /* Base styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background-color: #111;
            color: #fff;
            font-family: 'Courier New', monospace;
            overflow-x: hidden;
            min-height: 100vh;
            position: relative;
        }
        
        /* Background video */
        #bgVideo {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: -1;
            opacity: 0.3;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }
        
        /* Receipt styling */
        .receipt {
            background-color: #fff;
            color: #000;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
            margin-bottom: 20px;
            width: 100%;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .receipt::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: repeating-linear-gradient(
                90deg,
                transparent,
                transparent 5px,
                #000 5px,
                #000 10px
            );
        }
        
        .receipt::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: repeating-linear-gradient(
                90deg,
                transparent,
                transparent 5px,
                #000 5px,
                #000 10px
            );
        }
        
        /* Glitch effects */
        .glitch {
            position: relative;
        }
        
        .glitch::before, .glitch::after {
            content: attr(data-text);
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .glitch::before {
            left: 2px;
            text-shadow: -1px 0 red;
            clip: rect(44px, 450px, 56px, 0);
            animation: glitch-anim 5s infinite linear alternate-reverse;
        }
        
        .glitch::after {
            left: -2px;
            text-shadow: 1px 0 blue;
            clip: rect(44px, 450px, 56px, 0);
            animation: glitch-anim2 5s infinite linear alternate-reverse;
        }
        
        @keyframes glitch-anim {
            0% { clip: rect(42px, 9999px, 44px, 0); }
            5% { clip: rect(12px, 9999px, 59px, 0); }
            10% { clip: rect(48px, 9999px, 29px, 0); }
            15% { clip: rect(42px, 9999px, 73px, 0); }
            20% { clip: rect(63px, 9999px, 27px, 0); }
            25% { clip: rect(34px, 9999px, 55px, 0); }
            30% { clip: rect(86px, 9999px, 73px, 0); }
            35% { clip: rect(20px, 9999px, 20px, 0); }
            40% { clip: rect(26px, 9999px, 60px, 0); }
            45% { clip: rect(25px, 9999px, 66px, 0); }
            50% { clip: rect(57px, 9999px, 98px, 0); }
            55% { clip: rect(5px, 9999px, 46px, 0); }
            60% { clip: rect(82px, 9999px, 31px, 0); }
            65% { clip: rect(54px, 9999px, 27px, 0); }
            70% { clip: rect(28px, 9999px, 99px, 0); }
            75% { clip: rect(45px, 9999px, 69px, 0); }
            80% { clip: rect(23px, 9999px, 85px, 0); }
            85% { clip: rect(54px, 9999px, 84px, 0); }
            90% { clip: rect(45px, 9999px, 47px, 0); }
            95% { clip: rect(37px, 9999px, 20px, 0); }
            100% { clip: rect(4px, 9999px, 91px, 0); }
        }
        
        @keyframes glitch-anim2 {
            0% { clip: rect(65px, 9999px, 100px, 0); }
            5% { clip: rect(52px, 9999px, 74px, 0); }
            10% { clip: rect(79px, 9999px, 85px, 0); }
            15% { clip: rect(75px, 9999px, 5px, 0); }
            20% { clip: rect(67px, 9999px, 61px, 0); }
            25% { clip: rect(14px, 9999px, 79px, 0); }
            30% { clip: rect(1px, 9999px, 66px, 0); }
            35% { clip: rect(86px, 9999px, 30px, 0); }
            40% { clip: rect(23px, 9999px, 98px, 0); }
            45% { clip: rect(85px, 9999px, 72px, 0); }
            50% { clip: rect(71px, 9999px, 75px, 0); }
            55% { clip: rect(2px, 9999px, 48px, 0); }
            60% { clip: rect(30px, 9999px, 16px, 0); }
            65% { clip: rect(59px, 9999px, 50px, 0); }
            70% { clip: rect(41px, 9999px, 62px, 0); }
            75% { clip: rect(2px, 9999px, 82px, 0); }
            80% { clip: rect(47px, 9999px, 73px, 0); }
            85% { clip: rect(3px, 9999px, 27px, 0); }
            90% { clip: rect(26px, 9999px, 55px, 0); }
            95% { clip: rect(42px, 9999px, 97px, 0); }
            100% { clip: rect(38px, 9999px, 49px, 0); }
        }
        
        .flicker {
            animation: flicker 3s linear infinite;
        }
        
        @keyframes flicker {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }
        
        .shake {
            animation: shake 0.5s linear infinite;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-2px); }
            20%, 40%, 60%, 80% { transform: translateX(2px); }
        }
        
        /* Button styles */
        button {
            background-color: #000;
            color: #fff;
            border: 1px solid #fff;
            padding: 10px 20px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            margin: 10px 5px;
            transition: all 0.3s;
        }
        
        button:hover {
            background-color: #fff;
            color: #000;
        }
        
        /* Stage-specific styles */
        .stage {
            display: none;
            text-align: center;
        }
        
        .active {
            display: block;
        }
        
        /* Printer animation */
        .printer {
            position: relative;
            width: 300px;
            height: 100px;
            margin: 0 auto 20px;
            background-color: #333;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .printer::before {
            content: "";
            position: absolute;
            top: 20px;
            left: 10px;
            right: 10px;
            height: 5px;
            background-color: #666;
        }
        
        .paper {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 250px;
            height: 0;
            background-color: #fff;
            transition: height 2s ease-in-out;
            overflow: hidden;
        }
        
        .paper-content {
            padding: 20px;
            color: #000;
            text-align: left;
            opacity: 0;
            transition: opacity 1s ease-in-out 1s;
        }
        
        .paper.printed {
            height: 200px;
        }
        
        .paper.printed .paper-content {
            opacity: 1;
        }
        
        /* Clickable receipt items */
        .receipt-line {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px dashed #ccc;
        }
        
        .product-name {
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .product-name:hover {
            text-decoration: underline;
        }
        
        .amount {
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .amount:hover {
            transform: translateY(-2px);
        }
        
        /* Amount overlay */
        .amount-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }
        
        .amount-overlay.active {
            opacity: 1;
            pointer-events: all;
        }
        
        .amount-text {
            font-size: 2rem;
            text-align: center;
            padding: 20px;
            background-color: #fff;
            color: #000;
            border-radius: 5px;
            max-width: 80%;
        }
        
        /* Stage 1 - Overcharged Items */
        .receipt-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px dashed #ccc;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .receipt-item.crossed-out {
            text-decoration: line-through;
            opacity: 0.5;
        }
        
        /* Stage 2 - Hidden Code */
        .hidden-text {
            background-color: #000;
            color: #000;
            padding: 10px;
            user-select: none;
            cursor: grab;
            position: relative;
        }
        
        .hidden-text.revealed {
            color: #fff;
            background-color: #333;
        }
        
        /* Stage 3 - Endless Scroll */
        .scroll-container {
            height: 300px;
            overflow-y: scroll;
            border: 1px solid #fff;
            padding: 10px;
            text-align: left;
        }
        
        /* Stage 4 - Glitch Portal */
        .game-container {
            position: relative;
            height: 400px;
            border: 1px solid #fff;
            overflow: hidden;
            margin-bottom: 20px;
        }
        
        .falling-receipt {
            position: absolute;
            background-color: #fff;
            color: #000;
            padding: 5px 10px;
            border-radius: 3px;
            font-size: 12px;
            cursor: pointer;
            transition: transform 0.1s;
        }
        
        .falling-receipt.caught {
            animation: caught 0.5s forwards;
        }
        
        @keyframes caught {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(0); opacity: 0; }
        }
        
        .score {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 5px 10px;
            border-radius: 5px;
        }
        
        /* Stage 5 - Progress Bar */
        .progress-container {
            width: 100%;
            background-color: #333;
            border-radius: 5px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .progress-bar {
            width: 0%;
            height: 30px;
            background-color: #fff;
            transition: width 0.1s linear;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #000;
            font-weight: bold;
        }
        
        .status-text {
            margin-top: 10px;
            font-style: italic;
        }
        
        /* Final stage */
        .shredder {
            position: relative;
            width: 300px;
            height: 100px;
            margin: 0 auto 20px;
            background-color: #333;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .shredder::before {
            content: "";
            position: absolute;
            top: 40px;
            left: 10px;
            right: 10px;
            height: 10px;
            background-color: #666;
        }
        
        .shredded-paper {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 250px;
            height: 100%;
            background: repeating-linear-gradient(
                0deg,
                transparent,
                transparent 5px,
                #fff 5px,
                #fff 10px
            );
            animation: shred 2s forwards;
        }
        
        @keyframes shred {
            0% { height: 100%; }
            100% { height: 0; }
        }
        
        /* Download button */
        .download-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #000;
            color: #fff;
            border: 1px solid #fff;
            padding: 10px;
            border-radius: 50%;
            cursor: pointer;
            z-index: 10;
        }
        
        /* Forced scroll stage */
        .forced-scroll-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #000;
            z-index: 1000;
            display: none;
            overflow: hidden;
        }
        
        .forced-scroll-container.active {
            display: block;
        }
        
        .forced-receipt {
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 400px;
            background-color: #fff;
            color: #000;
            padding: 20px;
            transition: top 120s linear;
        }
        
        .forced-receipt.scrolling {
            top: -200%;
        }
        
        .exit-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.9);
            padding: 20px;
            border: 2px solid #fff;
            z-index: 1001;
            display: none;
            text-align: center;
            max-width: 80%;
        }
        
        .exit-message.active {
            display: block;
        }
        
        .encouragement-message {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.8);
            padding: 10px 20px;
            border-radius: 5px;
            z-index: 1001;
            display: none;
            text-align: center;
            max-width: 80%;
            animation: pulse 2s infinite;
        }
        
        .encouragement-message.active {
            display: block;
        }
        
        @keyframes pulse {
            0% { opacity: 0.7; }
            50% { opacity: 1; }
            100% { opacity: 0.7; }
        }
        
        /* Responsive adjustments */
        @media (max-width: 600px) {
            .container {
                padding: 10px;
            }
            
            .receipt {
                max-width: 100%;
            }
            
            .printer, .shredder {
                width: 100%;
                max-width: 300px;
            }
            
            .game-container {
                height: 300px;
            }
            
            .amount-text {
                font-size: 1.5rem;
            }
            
            .forced-receipt {
                width: 95%;
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <audio id="backgroundMusic" loop>
        <source src="stormy_weather.mp3" type="audio/mpeg">
        Your browser does not support the audio tag.
    </audio>

    <button id="startButton" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 1001; padding: 20px; font-size: 1.2rem;">Click to Begin</button>

    <video id="bgVideo" autoplay muted loop>
        <source src="kolppdkdkd" type="video/mp4">
        Your browser does not support the video tag.
    </video>
    
    <div class="amount-overlay" id="amountOverlay">
        <div class="amount-text" id="amountText"></div>
    </div>
    
    <div class="download-btn" id="downloadBtn" title="Download Receipt">↓</div>
    
    <div class="forced-scroll-container" id="forcedScrollContainer">
        <div class="forced-receipt" id="forcedReceipt">
            </div>
        
        <div class="exit-message" id="exitMessage">
            <h2>What are you doing?</h2>
            <p>Finish reading the receipt! It shows what you have purchased or you might have purchased.</p>
            <button id="continueReading">Continue Reading</button>
        </div>
        
        <div class="encouragement-message" id="encouragementMessage">
            </div>
    </div>
    
    <div class="container">
        <div id="stage0" class="stage active">
            <h1 class="glitch flicker" data-text="Receipt Glitch Labyrinth">Receipt Glitch Labyrinth</h1>
            <div class="printer">
                <div class="paper" id="printerPaper">
                    <div class="paper-content" id="printedReceipt">
                        </div>
                </div>
            </div>
            <button id="unrollBtn">Unroll Receipt</button>
        </div>
        
        <div id="stage1" class="stage">
            <div class="receipt">
                <h3>STORE RECEIPT</h3>
                <p>================================</p>
                <div class="receipt-item" data-fake="true">Patience Fee - ₹9,999</div>
                <div class="receipt-item" data-fake="false">Free Wi-Fi - ₹0.00</div>
                <div class="receipt-item" data-fake="true">Midlife Crisis - Priceless</div>
                <div class="receipt-item" data-fake="false">Tax - ₹120.50</div>
                <div class="receipt-item" data-fake="true">Invisible Ink - ₹4,299</div>
                <div class="receipt-item" data-fake="false">Subtotal - ₹1,200.50</div>
                <p>================================</p>
                <p>Tap to cross out fake charges</p>
            </div>
            <p id="stage1Message">Cross out at least 2 fake charges</p>
            <button id="stage1Btn" disabled>Continue</button>
        </div>
        
        <div id="stage2" class="stage">
            <div class="receipt">
                <h3>CORRUPTED DATA</h3>
                <p>================================</p>
                <div class="hidden-text" id="hiddenText">
                    #@!%$^&*()_+}{":?><~`//\\|| Y0u 4r3 n0t supp0s3d t0 b3 h3r3... @#$%^&*()
                </div>
                <p>================================</p>
                <p>Swipe or drag to reveal hidden message</p>
            </div>
            <button id="stage2Btn" disabled>Continue</button>
        </div>
        
        <div id="stage3" class="stage">
            <div class="receipt">
                <h3>SYSTEM STREAM</h3>
                <p>================================</p>
                <div class="scroll-container" id="endlessScroll">
                    </div>
                <p>================================</p>
            </div>
            <div id="stage3Question" style="display: none;">
                <p>Do you want to fix the receipt or let it glitch?</p>
                <button id="fixBtn">Fix Receipt</button>
                <button id="glitchBtn">Let It Glitch</button>
            </div>
        </div>
        
        <div id="stage4" class="stage">
            <h2 class="glitch" data-text="GLITCH PORTAL">GLITCH PORTAL</h2>
            <div class="game-container" id="gameContainer">
                <div class="score">Caught: <span id="score">0</span>/10</div>
            </div>
            <p>Catch the falling receipts to resolve the error</p>
            <button id="stage4Btn" disabled>Continue</button>
        </div>
        
        <div id="stage5" class="stage">
            <h2 class="flicker">SYSTEM REPAIR IN PROGRESS</h2>
            <div class="progress-container">
                <div class="progress-bar" id="progressBar">0%</div>
            </div>
            <p class="status-text" id="statusText">Initializing repair sequence...</p>
            <button id="stage5Btn" disabled>Continue</button>
        </div>
        
        <div id="finalStage" class="stage">
            <div class="shredder">
                <div class="shredded-paper"></div>
            </div>
            <h2 class="glitch" data-text="SYSTEM REBOOT COMPLETE">SYSTEM REBOOT COMPLETE</h2>
            <p>Your true purchase has been processed.</p>
            <p>Redirecting to secure portal...</p>
        </div>
    </div>

    <script>
        // NEW: JAVASCRIPT FOR THE START BUTTON
        const music = document.getElementById('backgroundMusic');
        const startButton = document.getElementById('startButton');

        startButton.addEventListener('click', () => {
            music.play();
            startButton.style.display = 'none'; // Hide the button after it's clicked
        });

        // Stage management
        let currentStage = 0;
        const totalStages = 6;
        let isForcedScrollActive = false;
        let scrollStartTime = null;
        let scrollDuration = 120000; // 120 seconds for forced scroll
        
        // Move to next stage
        function nextStage() {
            document.getElementById(`stage${currentStage}`).classList.remove('active');
            currentStage++;
            
            if (currentStage < totalStages) {
                document.getElementById(`stage${currentStage}`).classList.add('active');
                
                // Initialize stage-specific functionality
                initStage(currentStage);
            } else {
                // Final stage - start forced scroll before redirect
                startForcedScroll();
            }
        }
        
        // Initialize stage-specific functionality
        function initStage(stage) {
            switch(stage) {
                case 0:
                    // Initial printer animation
                    initStage0();
                    break;
                    
                case 1:
                    // Stage 1 - Overcharged items
                    initStage1();
                    break;
                    
                case 2:
                    // Stage 2 - Hidden code
                    initStage2();
                    break;
                    
                case 3:
                    // Stage 3 - Endless scroll
                    initStage3();
                    break;
                    
                case 4:
                    // Stage 4 - Mini-game
                    initStage4();
                    break;
                    
                case 5:
                    // Stage 5 - Progress bar
                    initStage5();
                    break;
            }
        }
        
        // Stage 0 functionality - Printer animation with clickable items
        function initStage0() {
            const paper = document.getElementById('printerPaper');
            const receiptContent = document.getElementById('printedReceipt');
            const unrollBtn = document.getElementById('unrollBtn');
            
            const receiptItems = [
                { product: "Digital Oxygen", amount: "₹499" },
                { product: "Cloud Storage for Dreams", amount: "₹1,299" },
                { product: "WiFi Signal Booster", amount: "₹799" },
                { product: "Invisible Ink Cartridge", amount: "₹2,499" },
                { product: "Time Travel Surcharge", amount: "₹9,999" },
                { product: "Digital Footprint Cleaner", amount: "₹3,999" },
                { product: "Privacy Tax", amount: "₹1,200" }
            ];
            
            let receiptHTML = `
                <h3>STORE RECEIPT</h3>
                <p>================================</p>
                <p>Date: ${new Date().toLocaleDateString()}</p>
                <p>Time: ${new Date().toLocaleTimeString()}</p>
                <p>================================</p>
            `;
            
            receiptItems.forEach(item => {
                receiptHTML += `
                    <div class="receipt-line">
                        <span class="product-name" data-product="${item.product}">${item.product}</span>
                        <span class="amount" data-amount="${item.amount}">${item.amount}</span>
                    </div>
                `;
            });
            
            receiptHTML += `
                <p>================================</p>
                <p>Total: ₹19,294</p>
                <p>================================</p>
                <p>Thank you for your purchase!</p>
            `;
            
            setTimeout(() => {
                paper.classList.add('printed');
                receiptContent.innerHTML = receiptHTML;
                
                setTimeout(() => {
                    // FIXED: Scoped selectors to #stage0
                    document.querySelectorAll('#stage0 .product-name').forEach(element => {
                        element.addEventListener('click', () => {
                            window.location.href = 'https://notthebestplacetobuystuff.in/our-mission';
                        });
                    });
                    
                    document.querySelectorAll('#stage0 .amount').forEach(element => {
                        element.addEventListener('click', () => {
                            const amount = element.getAttribute('data-amount');
                            const amountText = convertAmountToWords(amount);
                            document.getElementById('amountText').textContent = amountText;
                            document.getElementById('amountOverlay').classList.add('active');
                            
                            setTimeout(() => {
                                document.getElementById('amountOverlay').classList.remove('active');
                            }, 3000);
                        });
                    });
                }, 1000);
            }, 500);
            
            unrollBtn.addEventListener('click', nextStage);
        }
        
        // Convert amount to words (simplified version)
        function convertAmountToWords(amount) {
            const amountNum = parseInt(amount.replace('₹', '').replace(',', ''));
            const units = ['', 'One', 'Two', 'Three', 'Four', 'Five', 'Six', 'Seven', 'Eight', 'Nine'];
            const teens = ['Ten', 'Eleven', 'Twelve', 'Thirteen', 'Fourteen', 'Fifteen', 'Sixteen', 'Seventeen', 'Eighteen', 'Nineteen'];
            const tens = ['', '', 'Twenty', 'Thirty', 'Forty', 'Fifty', 'Sixty', 'Seventy', 'Eighty', 'Ninety'];
            if (amountNum === 0) return 'Zero Rupees';
            let words = '';
            if (amountNum >= 1000) {
                words += units[Math.floor(amountNum / 1000)] + ' Thousand ';
                amountNum %= 1000;
            }
            if (amountNum >= 100) {
                words += units[Math.floor(amountNum / 100)] + ' Hundred ';
                amountNum %= 100;
            }
            if (amountNum >= 20) {
                words += tens[Math.floor(amountNum / 10)] + ' ';
                amountNum %= 10;
            } else if (amountNum >= 10) {
                words += teens[amountNum - 10] + ' ';
                amountNum = 0;
            }
            if (amountNum > 0) {
                words += units[amountNum] + ' ';
            }
            return words.trim() + ' Rupees';
        }
        
        document.getElementById('downloadBtn').addEventListener('click', function() {
            const receipt = document.querySelector('.receipt.active') || document.getElementById('printedReceipt').parentElement;
            html2canvas(receipt).then(canvas => {
                const link = document.createElement('a');
                link.download = 'receipt.png';
                link.href = canvas.toDataURL();
                link.click();
            });
        });
        
        // Stage 1 functionality
        function initStage1() {
            // FIXED: Scoped selector to #stage1
            const items = document.querySelectorAll('#stage1 .receipt-item');
            const continueBtn = document.getElementById('stage1Btn');
            const message = document.getElementById('stage1Message');
            let crossedOutCount = 0;
            let fakeCrossedOut = 0;
            
            items.forEach(item => {
                item.addEventListener('click', () => {
                    if (!item.classList.contains('crossed-out')) {
                        item.classList.add('crossed-out');
                        crossedOutCount++;
                        
                        if (item.dataset.fake === 'true') {
                            fakeCrossedOut++;
                        }
                        
                        if (fakeCrossedOut >= 2) {
                            continueBtn.disabled = false;
                            message.textContent = "Correct! Proceeding to next stage...";
                            // FIXED: Scoped selector to #stage1
                            document.querySelector('#stage1 .receipt').classList.add('shake');
                            setTimeout(() => {
                                document.querySelector('#stage1 .receipt').classList.remove('shake');
                            }, 1000);
                        } else if (crossedOutCount >= 2) {
                            message.textContent = "Those aren't all fake charges. Try again!";
                        }
                    }
                });
            });
            
            continueBtn.addEventListener('click', nextStage);
        }
        
        // Stage 2 functionality
        function initStage2() {
            const hiddenText = document.getElementById('hiddenText');
            const continueBtn = document.getElementById('stage2Btn');
            let isRevealed = false;
            
            function startReveal(e) {
                if (isRevealed) return;
                e.preventDefault();
                hiddenText.classList.add('revealed');
                isRevealed = true;
                setTimeout(() => {
                    continueBtn.disabled = false;
                }, 1000);
            }

            hiddenText.addEventListener('mousedown', startReveal);
            hiddenText.addEventListener('touchstart', startReveal);
            continueBtn.addEventListener('click', nextStage);
        }
        
        // Stage 3 functionality
        function initStage3() {
            const scrollContainer = document.getElementById('endlessScroll');
            const questionDiv = document.getElementById('stage3Question');
            
            const content = [ "ITEM: Digital Oxygen - ₹499", "ITEM: Cloud Storage for Dreams - ₹1,299", "ITEM: WiFi Signal Booster - ₹799", "--------------------------------", "ASCII ART:", "  /\\_/\\", " ( o.o )", "  > ^ <", "--------------------------------", "MEME: One does not simply fix a glitched receipt", "--------------------------------", "ITEM: Invisible Ink Cartridge - ₹2,499", "ITEM: Time Travel Surcharge - ₹9,999", "--------------------------------", "SYSTEM: Processing... Processing...", "ERROR: Cannot compute meaning of life", "--------------------------------", "ITEM: Digital Footprint Cleaner - ₹3,999", "ITEM: Privacy Tax - ₹1,200", "--------------------------------", "MEME: I came, I saw, I got confused by the receipt", "--------------------------------", "ASCII ART:", "    _____", "  /     \\", " | () () |", "  \\  ^  /", "   |||||", "--------------------------------" ];
            let fullContent = [];
            for (let i = 0; i < 10; i++) {
                fullContent = fullContent.concat(content);
            }
            scrollContainer.innerHTML = fullContent.join('<br>');
            
            let scrollPosition = 0;
            const scrollInterval = setInterval(() => {
                scrollPosition += 2;
                scrollContainer.scrollTop = scrollPosition;
                
                // FIXED: Changed duration to be closer to 20 seconds
                if (scrollPosition > 1000) { // Approx 25 seconds
                    clearInterval(scrollInterval);
                    scrollContainer.innerHTML = "SYSTEM GLITCH DETECTED<br>=====================<br>ERROR: STREAM CORRUPTED";
                    scrollContainer.classList.add('glitch');
                    setTimeout(() => {
                        questionDiv.style.display = 'block';
                    }, 1000);
                }
            }, 50);
            
            document.getElementById('fixBtn').addEventListener('click', nextStage);
            document.getElementById('glitchBtn').addEventListener('click', nextStage);
        }
        
        // Stage 4 functionality
        function initStage4() {
            const gameContainer = document.getElementById('gameContainer');
            const scoreElement = document.getElementById('score');
            const continueBtn = document.getElementById('stage4Btn');
            let score = 0;
            let gameInterval;

            const receiptLabels = [ "Drip Insurance - ₹9999", "Handling Fee of Happiness - ₹420", "Air Tax - ₹299", "Digital Soul - ₹7,777", "WiFi Aura - ₹1,234", "Cloud Emotions - ₹5,555", "Virtual Reality Surcharge - ₹3,333", "Data Detox - ₹6,666", "Dream Storage - ₹8,888", "Time Compression - ₹9,999", "Reality Glitch Fix - ₹4,444", "Existence Verification - ₹2,222" ];
            
            function createReceipt() {
                if (score >= 10) {
                    clearInterval(gameInterval);
                    return;
                };
                
                const receipt = document.createElement('div');
                receipt.className = 'falling-receipt';
                receipt.textContent = receiptLabels[Math.floor(Math.random() * receiptLabels.length)];
                
                const leftPos = Math.random() * (gameContainer.offsetWidth - 150); // Adjust for receipt width
                receipt.style.left = `${leftPos}px`;
                receipt.style.top = '-50px';
                gameContainer.appendChild(receipt);
                
                let topPos = -50;
                const fallInterval = setInterval(() => {
                    topPos += 3;
                    receipt.style.top = `${topPos}px`;
                    if (topPos > gameContainer.offsetHeight) {
                        clearInterval(fallInterval);
                        if (gameContainer.contains(receipt)) {
                           gameContainer.removeChild(receipt);
                        }
                    }
                }, 50);
                
                receipt.addEventListener('click', () => {
                    if (receipt.classList.contains('caught')) return;
                    receipt.classList.add('caught');
                    score++;
                    scoreElement.textContent = score;
                    if (score >= 10) {
                        continueBtn.disabled = false;
                        clearInterval(gameInterval); // Stop new receipts from appearing
                    }
                    setTimeout(() => {
                        if (gameContainer.contains(receipt)) {
                            gameContainer.removeChild(receipt);
                        }
                    }, 500);
                });
            }
            
            gameInterval = setInterval(createReceipt, 800); // Create a receipt every 0.8 seconds
            continueBtn.addEventListener('click', nextStage);
        }
        
        // Stage 5 functionality
        function initStage5() {
            const progressBar = document.getElementById('progressBar');
            const statusText = document.getElementById('statusText');
            const continueBtn = document.getElementById('stage5Btn');
            
            const statusMessages = [ "Initializing repair sequence...", "Calibrating your wardrobe taste...", "Counting how many times you've said 'Almost but nope'...", "Encrypting your drip...", "Optimizing life choices...", "Defragmenting reality...", "Rebooting existential crisis...", "Recalculating life's meaning...", "Downloading more RAM...", "Polishing digital aura...", "Finalizing system integrity..." ];
            
            let progress = 0;
            const totalTime = 240000; // 4 minutes
            const intervalTime = 100;
            const increments = totalTime / intervalTime;
            const progressIncrement = 100 / increments;
            let messageIndex = 0;
            statusText.textContent = statusMessages[0];
            
            const progressInterval = setInterval(() => {
                progress += progressIncrement;
                if (progress > 100) progress = 100;
                progressBar.style.width = `${progress}%`;
                progressBar.textContent = `${Math.floor(progress)}%`;
                
                let nextMessageIndex = Math.floor(progress / 10);
                if (nextMessageIndex > messageIndex && statusMessages[nextMessageIndex]) {
                    messageIndex = nextMessageIndex;
                    statusText.textContent = statusMessages[messageIndex];
                }
                
                if (progress >= 100) {
                    clearInterval(progressInterval);
                    progressBar.textContent = "100%";
                    statusText.textContent = "System repair complete!";
                    continueBtn.disabled = false;
                }
            }, intervalTime);
            
            continueBtn.addEventListener('click', nextStage);
        }
        
        // Forced scroll functionality
        function startForcedScroll() {
            isForcedScrollActive = true;
            scrollStartTime = Date.now();
            document.getElementById('forcedScrollContainer').classList.add('active');
            
            const forcedReceipt = document.getElementById('forcedReceipt');
            let receiptHTML = `
                <h3>FINAL TRANSACTION RECEIPT</h3>
                <p>================================</p>
                <p>Date: ${new Date().toLocaleDateString()}</p>
                <p>Time: ${new Date().toLocaleTimeString()}</p>
                <p>Transaction ID: GL1TCH-${Math.floor(Math.random() * 10000)}</p>
                <p>================================</p>
            `;
            const items = [ "Digital Consciousness Upgrade - ₹14,999", "Reality Distortion Field - ₹7,777", "Temporal Loop Pass - ₹12,345", "Quantum Entanglement Kit - ₹9,876", "Parallel Universe Access - ₹19,999", "Dream Manipulation Software - ₹6,666", "Emotional Intelligence Boost - ₹8,888", "Existential Crisis Insurance - ₹15,000", "Time Dilation Device - ₹22,222", "Memory Encryption Service - ₹5,555", "Virtual Identity Protection - ₹11,111", "Consciousness Backup - ₹25,000", "Reality Glitch Repair - ₹3,333", "Digital Soul Preservation - ₹18,000", "Multiverse Travel Permit - ₹30,000", "Quantum Computing Time - ₹7,500", "Neural Interface Upgrade - ₹12,500", "Emotional Stability Package - ₹9,999", "Digital Afterlife Plan - ₹50,000", "Reality Anchoring Device - ₹13,333" ];
            items.forEach(item => {
                receiptHTML += `<p>${item}</p>`;
            });
            receiptHTML += `
                <p>================================</p>
                <p>Subtotal: ₹278,883</p>
                <p>Reality Tax: ₹55,777</p>
                <p>Consciousness Fee: ₹33,333</p>
                <p>================================</p>
                <p>TOTAL: ₹368,000</p>
                <p>================================</p>
                <p>Thank you for your metaphysical purchase!</p>
                <p>Your transaction has been processed across multiple dimensions.</p>
                <p>Please keep this receipt for your records.</p>
                <p>Reality may vary based on your perception.</p>
                <p>================================</p>
                <p>WARNING: Do not attempt to exit before reading completely.</p>
                <p>Your consciousness synchronization depends on it.</p>
                <p>================================</p>
            `;
            for (let i = 0; i < 20; i++) {
                receiptHTML += `<p>Additional security layer ${i+1}: Activated</p>`;
            }
            receiptHTML += `
                <p>================================</p>
                <p>SYSTEM MESSAGE: Almost done...</p>
                <p>Your patience is appreciated.</p>
                <p>================================</p>
            `;
            forcedReceipt.innerHTML = receiptHTML;
            
            setTimeout(() => {
                forcedReceipt.classList.add('scrolling');
            }, 1000);
            
            const encouragementMessages = [ "Sure it is slow, but once you read it, it's going to be good.", "Something else is going to happen, so please don't exit.", "Please stay. Well, I mean you can't exit, but I am telling something.", "You're almost there! The best part is coming up.", "Just a little more... I promise it will be worth it.", "Don't miss the surprise at the end!", "Your persistence is being recorded and appreciated.", "The system is calibrating to your reading speed.", "This is important for your digital footprint.", "Finalizing your multidimensional transaction..." ];
            let encouragementIndex = 0;
            const encouragementInterval = setInterval(() => {
                if (encouragementIndex < encouragementMessages.length) {
                    document.getElementById('encouragementMessage').textContent = encouragementMessages[encouragementIndex];
                    document.getElementById('encouragementMessage').classList.add('active');
                    encouragementIndex++;
                    setTimeout(() => {
                        document.getElementById('encouragementMessage').classList.remove('active');
                    }, 5000);
                } else {
                    clearInterval(encouragementInterval);
                }
            }, 10000);
            
            setupExitPrevention();
            
            setTimeout(() => {
                isForcedScrollActive = false;
                window.location.href = 'https://notthebestplacetobuystuff.in';
            }, scrollDuration + 2000);
        }
        
        // Exit prevention system
        function setupExitPrevention() {
            document.addEventListener('contextmenu', function(e) {
                if (isForcedScrollActive) {
                    e.preventDefault();
                    showExitMessage();
                }
            });
            
            document.addEventListener('keydown', function(e) {
                if (isForcedScrollActive) {
                    if (e.key === 'F12' || (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'J' || e.key === 'C')) || (e.ctrlKey && e.key === 'u')) {
                        e.preventDefault();
                        showExitMessage();
                    }
                    if (e.key === 'Escape') {
                        e.preventDefault();
                        showExitMessage();
                    }
                }
            });
            
            window.addEventListener('beforeunload', function(e) {
                if (isForcedScrollActive) {
                    e.preventDefault();
                    e.returnValue = 'Are you sure you want to leave? The receipt reading is not complete.';
                    return e.returnValue;
                }
            });
            
            document.addEventListener('mouseleave', function(e) {
                if (isForcedScrollActive && e.clientY < 0) {
                    showExitMessage();
                }
            });
        }
        
        // Show exit message
        function showExitMessage() {
            document.getElementById('exitMessage').classList.add('active');
            document.getElementById('continueReading').addEventListener('click', function() {
                document.getElementById('exitMessage').classList.remove('active');
            });
        }
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            initStage(0);
        });
    </script>
    
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
</body>
</html>
